<nz-table #eventsTableTag [nzData]="events" nzSize="default" [nzFrontPagination]="false" [nzLoading]="loading">
  <thead>
    <tr>
      <th nzWidth="60px"></th>
      <th>Name</th>
      <th>Date</th>
      <th>Spots Filled</th>
    </tr>
  </thead>
  <tbody>
    @for (event of eventsTable?.data; track event.id) {
      <tr>
        <td [nzExpand]="expandSet.has(event.id)" (nzExpandChange)="onExpandChange(event.id, $event)"></td>
        <td>
          @if (event.deletedAt) {
            <div class="text-warning" style="font-style: italic">Archived</div>
          }
          {{ event.name }}
        </td>
        <td>{{ event.eventDate | date: "short" }}</td>
        <td>
          @let participantsGoing = event | participantsGoing;
          @switch (event.limitParticipants) {
            @case (true) {
              <div class="d-flex spot-progress">
                <nz-progress
                  [nzPercent]="getPercent(participantsGoing, event.numOfPeople)"
                  [nzSteps]="event.numOfPeople"
                  [nzShowInfo]="false"
                  nzStrokeColor="#1890ff"
                ></nz-progress>
                <div class="ms-2">{{ participantsGoing.length }}/{{ event.numOfPeople }}</div>
              </div>
            }
            @case (false) {
              <div>{{ participantsGoing.length }} participant{{ participantsGoing.length === 1 ? "" : "s" }}</div>
            }
          }
        </td>
      </tr>
      <tr [nzExpand]="expandSet.has(event.id)">
        <nz-collapse>
          <div class="w-100 p-2">
            <div class="mb-3 w-100 d-flex buttons">
              @if (event.deletedAt) {
                <!--              <button nz-button>-->
                <!--                <fa-icon [icon]="restore" size="1x"></fa-icon>-->
                <!--              </button>-->
              } @else {
                <div class="d-flex justify-content-evenly w-100">
                  <div class="d-flex flex-column align-items-center" (click)="copyToClipboard(event)">
                    <fa-icon class="text-info" [icon]="copy"></fa-icon>
                    Copy
                  </div>
                  <a
                    class="d-flex flex-column align-items-center"
                    [href]="event.eventUrl"
                    target="_blank"
                    style="text-decoration: none; color: white"
                  >
                    <fa-icon class="text-warning" [icon]="open"></fa-icon>
                    Open
                  </a>
                  <div class="d-flex flex-column align-items-center" (click)="editEvent.emit(event.id)">
                    <fa-icon class="text-primary" [icon]="edit"></fa-icon>
                    Edit
                  </div>
                  <div
                    class="d-flex flex-column align-items-center"
                    nz-popconfirm
                    nzPopconfirmTitle="Are you sure?"
                    (nzOnConfirm)="archiveEvent.emit(event.id)"
                  >
                    <fa-icon class="text-danger" [icon]="archive"></fa-icon>
                    Archive
                  </div>
                </div>
              }
            </div>
            @if (event.eventParticipants.length > 0) {
              <nz-list nzBordered>
                @for (participant of event.eventParticipants; track participant.id) {
                  <nz-list-item>
                    <div>
                      @if (participant.isGoing) {
                        <fa-icon [icon]="participantGoing" class="text-success me-2"></fa-icon>
                      }
                      @if (!participant.isGoing) {
                        <fa-icon [icon]="participantNotGoing" class="text-danger me-2"></fa-icon>
                      }
                      {{ participant.name }}
                    </div>
                    <fa-icon [icon]="participantChange" (click)="editParticipant.emit(participant.id)"></fa-icon>
                  </nz-list-item>
                }
              </nz-list>
            }
          </div>
        </nz-collapse>
      </tr>
    }
  </tbody>
</nz-table>
